# Audio Output Guide

## ğŸ“ Audio File Locations

### Primary Location (After Generation)
```
data/approved/week-YYYY-WWW/podcast.mp3
```

**Example:**
```
data/approved/week-2026-W04/podcast.mp3
```

### Website Location (After Publishing)
```
website/public/weeks/YYYY-WWW/podcast.mp3
```

**Example:**
```
website/public/weeks/2026-W04/podcast.mp3
```

## ğŸ”„ Audio Generation Workflow

### Step 1: Content Must Be Formatted First
Audio generation is triggered after content formatting:
1. Stories are approved
2. FormatterAgent generates newsletter/Twitter content
3. **AudioAgent** is triggered by `CONTENT_FORMATTED` event
4. Audio is generated and saved

### Step 2: Audio Generation Process
1. **Script Generation**: Claude AI creates a 5-minute podcast script
2. **Text-to-Speech**: ElevenLabs converts script to MP3 audio
3. **File Save**: Saved to `data/approved/week-{week_id}/podcast.mp3`

### Step 3: Website Publishing
When WebsiteAgent runs, it copies the audio to:
```
website/public/weeks/{week_id}/podcast.mp3
```

## ğŸ™ï¸ How to Generate Audio

### Option 1: Full Publishing Pipeline
```bash
# 1. Approve stories
mkdir -p data/approved/week-2026-W04
touch data/approved/week-2026-W04/APPROVED.txt

# 2. Run publishing pipeline (triggers audio generation)
python scripts/run_publishing_pipeline.py 2026-W04
```

### Option 2: Direct Audio Generation
```bash
# Generate audio for a specific week
python scripts/generate_demo_audio.py
```

### Option 3: Manual Trigger
```python
import asyncio
from events.event_bus import EventBus
from agents.audio_agent import AudioAgent
from events.event_types import Event, EventType
from datetime import datetime

async def generate_audio(week_id):
    bus = EventBus()
    audio_agent = AudioAgent(bus)
    
    event = Event(
        event_type=EventType.CONTENT_FORMATTED,
        timestamp=datetime.now(),
        data={'week_id': week_id},
        agent_id='manual',
        correlation_id='manual-123'
    )
    
    await audio_agent.process(event)

# Run
asyncio.run(generate_audio('2026-W04'))
```

## ğŸ“‹ Requirements

### API Keys Needed
1. **ELEVENLABS_API_KEY** - Your ElevenLabs API key
2. **ELEVENLABS_VOICE_ID** - The voice ID to use (e.g., "21m00Tcm4TlvDq8ikWAM")

### Check Configuration
```bash
python scripts/check_api_keys.py
```

Should show:
```
âœ… ELEVENLABS_API_KEY: Available
âœ… ELEVENLABS_VOICE_ID: Available
```

## ğŸ” Finding Audio Files

### Check for Existing Audio
```bash
# Find all MP3 files
find data/approved -name "*.mp3" -type f

# Find in website
find website/public -name "*.mp3" -type f

# List all approved weeks
ls -la data/approved/
```

### Check File Size
```bash
ls -lh data/approved/week-*/podcast.mp3
```

Expected size: ~2-5 MB for a 5-minute podcast

## ğŸ¯ Current Status

### Check if Audio Exists
```bash
cd gastown-news-agents
find . -name "podcast.mp3" -type f
```

### If No Audio Found
1. **Check API keys**: `python scripts/check_api_keys.py`
2. **Check logs**: `tail -f logs/audio_agent.log`
3. **Run generation**: `python scripts/generate_demo_audio.py`

## ğŸ“ Audio File Details

### Format
- **Type**: MP3
- **Duration**: ~5 minutes
- **Voice**: Gen Z-friendly (excited teenager with composure)
- **Content**: Weekly news summary script

### Script Generation
The script is generated by Claude AI with:
- Intro (15 seconds)
- Story segments (4 minutes)
- Outro (15 seconds)
- Conversational tone
- Gen Z-focused explanations

## ğŸš¨ Troubleshooting

### "ElevenLabs not installed"
```bash
pip install elevenlabs
```

### "ELEVENLABS_API_KEY not set"
Add to `.env`:
```
ELEVENLABS_API_KEY=your_key_here
ELEVENLABS_VOICE_ID=your_voice_id_here
```

### "No processed data found"
Run consolidation first:
```bash
python scripts/run_weekly_consolidation.py
```

### Audio file not created
1. Check logs: `tail -f logs/audio_agent.log`
2. Verify API keys are set
3. Check ElevenLabs account has credits
4. Ensure week_id matches processed data

## ğŸ“‚ Directory Structure

```
data/
â””â”€â”€ approved/
    â””â”€â”€ week-2026-W04/
        â”œâ”€â”€ podcast.mp3          â† Audio file here
        â”œâ”€â”€ newsletter.html
        â”œâ”€â”€ twitter.json
        â””â”€â”€ APPROVED.txt

website/
â””â”€â”€ public/
    â””â”€â”€ weeks/
        â””â”€â”€ 2026-W04/
            â””â”€â”€ podcast.mp3      â† Copied here for website
```

## ğŸ¬ Quick Start

To generate audio right now:

```bash
# 1. Ensure you have processed data
python scripts/create_demo_data.py

# 2. Generate audio
python scripts/generate_demo_audio.py

# 3. Check output
ls -lh data/approved/week-*/podcast.mp3
```

---

**Audio files are saved to:** `data/approved/week-{week_id}/podcast.mp3`
